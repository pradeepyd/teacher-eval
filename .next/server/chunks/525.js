"use strict";exports.id=525,exports.ids=[525],exports.modules={6699:(a,b,c)=>{c.d(b,{w:()=>g});var d=c(43210),e=c(82136);let f={evaluationStatus:null,startData:null,endData:null,termState:null,isLoading:!1,hasData:!1};function g(){let{data:a,status:b}=(0,e.useSession)(),[c,g]=(0,d.useState)(!1),[h,i]=(0,d.useState)(null),j=(0,d.useCallback)(async()=>{if(!f.isLoading&&(!f.hasData||c)){f.isLoading=!0,g(!0),i(null);try{let b=a?.user?.departmentId;if(!b)throw Error("No department ID found");let[c,d]=await Promise.all([fetch("/api/teacher-evaluation/status"),fetch(`/api/departments/${b}/term-state`)]);if(!c.ok||!d.ok)throw Error("Failed to load teacher data");let e=await c.json(),g=await d.json(),h=e.data||e,i=g.data||g;f={evaluationStatus:h,startData:null,endData:null,termState:i,isLoading:!1,hasData:!0}}catch(a){i(a instanceof Error?a.message:"Failed to load data"),f.isLoading=!1,f.evaluationStatus=null,f.termState=null}finally{g(!1)}}},[a]),k=(0,d.useCallback)(async a=>{try{let b=await fetch(`/api/teacher-evaluation/questions?term=${a}`);if(!b.ok)throw Error(`Failed to fetch ${a} evaluation data`);let c=await b.json(),d=c.data||c;return"START"===a?f.startData=d:f.endData=d,d}catch(a){throw a}},[]),l=(0,d.useCallback)(()=>{f.hasData=!1,f.evaluationStatus=null,f.startData=null,f.endData=null,f.termState=null},[]),m=(0,d.useCallback)(()=>{l(),j()},[j,l]);return{evaluationStatus:(a=>{if(!a)return null;let b={...a};return b.start&&(b.start.answersCount=Math.min(b.start.answersCount||0,b.start.questionsCount||0)),b.end&&(b.end.answersCount=Math.min(b.end.answersCount||0,b.end.questionsCount||0)),b})(f.evaluationStatus),startData:f.startData,endData:f.endData,termState:f.termState,loading:c||f.isLoading,error:h,refetch:m,invalidateCache:l,fetchTermData:k,submitAnswers:(0,d.useCallback)(async(a,b,c)=>{try{let d=await fetch("/api/teacher-answers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({answers:a,selfComment:b,term:c})});if(!d.ok)throw Error("Failed to submit answers");let e=await d.json(),g=e.data||e;try{let a=await fetch("/api/teacher-evaluation/status");if(a.ok){let b=await a.json(),c=b.data||b;f.evaluationStatus=c}}catch(a){console.warn("Failed to fetch fresh status after submission:",a)}return g}catch(a){throw a}},[]),getEvaluationReport:(0,d.useCallback)(async a=>{try{let b=await fetch(`/api/reviews/teacher/evaluation-report?term=${a}`);if(!b.ok)throw Error("Failed to get evaluation report");let c=await b.json();return c.data||c}catch(a){throw a}},[]),fetchEvaluation:(0,d.useCallback)(async a=>{try{let b=await fetch(`/api/teacher-evaluation/${a}`);if(!b.ok)throw Error("Failed to fetch evaluation");let c=await b.json();return c.data||c}catch(a){throw a}},[]),updateEvaluation:(0,d.useCallback)(async(a,b)=>{try{let c=await fetch(`/api/teacher-evaluation/${a}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});if(!c.ok)throw Error("Failed to update evaluation");let d=await c.json(),e=d.data||d;return{success:!0,evaluation:e}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Unknown error"}}},[]),fetchQuestions:(0,d.useCallback)(async a=>{try{let b=await fetch(`/api/teacher-evaluation/questions?term=${a}`);if(!b.ok)throw Error(`Failed to fetch ${a} questions`);let c=await b.json();return c.data||c}catch(a){throw a}},[]),updateAnswers:(0,d.useCallback)(async a=>{try{let b=await fetch("/api/teacher-answers",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!b.ok)throw Error("Failed to update answers");let c=await b.json();return c.data||c}catch(a){throw a}},[])}}},20092:(a,b,c)=>{c.d(b,{A:()=>l});var d=c(60687),e=c(82136),f=c(85814),g=c.n(f),h=c(16189),i=c(47033),j=c(95758);function k({children:a,title:b,showBack:c=!0,showTitle:f=!0}){let{data:j}=(0,e.useSession)(),k=(0,h.useRouter)();return(0,d.jsxs)("div",{className:"min-h-screen bg-gray-50 pt-16",children:[(0,d.jsx)("nav",{className:"bg-white shadow-sm border-b fixed inset-x-0 top-0 z-50",children:(0,d.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,d.jsxs)("div",{className:"flex justify-between h-16",children:[(0,d.jsx)("div",{className:"flex items-center",children:(0,d.jsx)(g(),{href:"/dashboard",className:"text-xl font-semibold text-gray-900",children:"MCQ Teacher Evaluation"})}),(0,d.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,d.jsxs)("div",{className:"text-sm text-gray-700",children:[(0,d.jsx)("span",{className:"font-medium",children:j?.user?.name}),(0,d.jsxs)("span",{className:"ml-2 text-gray-500",children:["(",j?.user?.role,")"]}),(0,d.jsx)("span",{className:"ml-2 text-gray-500",children:j?.user?.departmentName})]}),(0,d.jsx)("button",{onClick:()=>{(0,e.signOut)({callbackUrl:"/login"})},className:"bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm",children:"Logout"})]})]})})}),(0,d.jsx)("div",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:(0,d.jsxs)("div",{className:"px-4 py-6 sm:px-0",children:[c&&(0,d.jsx)("div",{className:"mb-2",children:(0,d.jsxs)("button",{"aria-label":"Back",onClick:()=>{window.history.length>1?k.back():k.push("/admin")},className:"inline-flex items-center justify-center rounded-md border border-gray-200 bg-white px-2 py-1 text-sm text-gray-700 hover:bg-gray-50",children:[(0,d.jsx)(i.A,{className:"h-4 w-4"}),(0,d.jsx)("span",{className:"ml-1 hidden sm:inline",children:"Back"})]})}),f&&b?(0,d.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-6",children:b}):null,a]})})]})}function l(a){return(0,d.jsx)(j.PageErrorBoundary,{pageName:"Dashboard Layout",children:(0,d.jsx)(k,{...a})})}},29840:(a,b,c)=>{c.d(b,{A:()=>g});var d=c(60687),e=c(43210),f=c(52581);function g({term:a,onSubmit:b,_onCancel:c,loading:g=!1}){let[h,i]=(0,e.useState)([]),[j,k]=(0,e.useState)({}),[l,m]=(0,e.useState)(""),[n,o]=(0,e.useState)(!1),[p,q]=(0,e.useState)(!0),[r,s]=(0,e.useState)(!0),[t,u]=(0,e.useState)(""),[v,w]=(0,e.useState)("idle"),x=(0,e.useRef)(null),y=(0,e.useRef)({}),z=h.length,A=h.reduce((a,b)=>a+ +((j[b.id]?.trim()||"").length>0),0),B=z?Math.round(A/z*100):0,C=b=>{p&&(y.current={answers:b.answers,selfComment:b.selfComment},x.current&&clearTimeout(x.current),x.current=setTimeout(async()=>{try{w("saving");let b={term:a};if(y.current.answers&&(b.answers=y.current.answers),"string"==typeof y.current.selfComment&&(b.selfComment=y.current.selfComment),b.answers||"string"==typeof b.selfComment){if(!(await fetch("/api/teacher-answers",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)})).ok)throw Error("Autosave failed");w("saved"),setTimeout(()=>w("idle"),1e3)}else w("idle")}catch(a){w("error")}},600))},D=(a,b)=>{p&&(k(c=>({...c,[a]:b})),C({answers:[{questionId:a,answer:b}],selfComment:void 0}))},E=(a,b,c)=>{let d;if(!p)return;let e=h.find(b=>b.id===a);if(e?.options?.some(a=>/target/i.test(a)||/actions to be implemented/i.test(a))){let d={selected:[],details:{}};try{d=j[a]?JSON.parse(j[a]):d,Array.isArray(d.selected)||(d.selected=[]),("object"!=typeof d.details||null===d.details)&&(d.details={})}catch(b){d={selected:j[a]?j[a].split(",").map(a=>a.trim()).filter(Boolean):[],details:{}}}let e=JSON.stringify({selected:c?Array.from(new Set([...d.selected||[],b])):(d.selected||[]).filter(a=>a!==b),details:d.details||{}});k(b=>({...b,[a]:e})),C({answers:[{questionId:a,answer:e}],selfComment:void 0});return}let f=j[a]?j[a].split(",").map(a=>a.trim()).filter(a=>a):[];d=c?[...f,b]:f.filter(a=>a!==b),k(b=>({...b,[a]:d.join(", ")})),C({answers:[{questionId:a,answer:d.join(", ")}],selfComment:void 0})};return r?(0,d.jsx)("div",{className:"flex items-center justify-center min-h-64",children:(0,d.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):t&&0===h.length?(0,d.jsx)("div",{className:"text-sm text-gray-600",children:"Failed to load the evaluation form."}):(0,d.jsx)("div",{className:"max-w-3xl mx-auto",children:(0,d.jsxs)("div",{className:"bg-white shadow-md rounded-xl border border-gray-100 overflow-hidden",children:[(0,d.jsxs)("div",{className:"px-6 py-5 border-b border-gray-100 bg-gradient-to-r from-indigo-50 to-blue-50",children:[(0,d.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:(()=>{switch(a){case"START":return"Start of Year Evaluation";case"END":return"End of Year Evaluation";default:return"Evaluation"}})()}),(0,d.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:(()=>{switch(a){case"START":return"Set your goals and expectations for the academic year";case"END":return"Reflect on your progress and achievements this year";default:return"Complete your evaluation"}})()})]}),(0,d.jsx)("span",{className:`inline-flex px-2.5 py-1 text-xs font-semibold rounded-full ${n?"bg-green-100 text-green-800":"bg-amber-100 text-amber-800"}`,children:n?"Submitted":"Draft"})]}),(0,d.jsxs)("div",{className:"mt-4",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-600 mb-1",children:[(0,d.jsx)("span",{children:"Progress"}),(0,d.jsxs)("span",{children:[A," of ",z," completed"]})]}),(0,d.jsx)("div",{className:"h-2 w-full rounded-full bg-gray-200 overflow-hidden",children:(0,d.jsx)("div",{className:"h-2 bg-indigo-600",style:{width:`${B}%`}})})]})]}),(0,d.jsxs)("form",{onSubmit:a=>{if(a.preventDefault(),!p)return;let c=h.filter(a=>!j[a.id]||""===j[a.id].trim());if(c.length>0){u(`Please answer all questions. Missing: ${c.length} questions`),f.oR.error("Please answer all questions before submitting");return}if(!l.trim()){u("Self comment is required"),f.oR.error("Self comment is required");return}b(h.map(a=>({questionId:a.id,answer:j[a.id]})),l)},className:"p-6",children:[(0,d.jsxs)("div",{className:"space-y-8",children:[h.map((a,b)=>(0,d.jsx)("div",{className:"pb-6",children:(0,d.jsxs)("div",{className:"flex items-start gap-3",children:[(0,d.jsx)("span",{className:"flex-shrink-0 w-7 h-7 bg-indigo-100 text-indigo-700 rounded-full flex items-center justify-center text-xs font-semibold",children:b+1}),(0,d.jsxs)("div",{className:"flex-1",children:[(0,d.jsx)("h3",{className:"text-base md:text-lg font-medium text-gray-900 mb-3",children:a.question}),"TEXT"===a.type&&(0,d.jsx)("input",{type:"text",value:j[a.id]||"",onChange:b=>D(a.id,b.target.value),className:"block w-full rounded-lg border border-gray-300 bg-white/90 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm px-3 py-2",placeholder:"Enter your answer...",disabled:!p,required:!0}),"TEXTAREA"===a.type&&(0,d.jsx)("textarea",{value:j[a.id]||"",onChange:b=>D(a.id,b.target.value),rows:4,className:"block w-full rounded-lg border border-gray-300 bg-white/90 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm px-3 py-2",placeholder:"Enter your detailed answer...",disabled:!p,required:!0}),"MCQ"===a.type&&(0,d.jsx)("div",{className:"space-y-3",children:a.options.map((b,c)=>(0,d.jsxs)("label",{className:"flex items-center",children:[(0,d.jsx)("input",{type:"radio",name:`question_${a.id}`,value:b,checked:j[a.id]===b,onChange:b=>D(a.id,b.target.value),className:"h-4 w-4 accent-indigo-600 focus:ring-indigo-500 border-gray-300",disabled:!p,required:!0}),(0,d.jsx)("span",{className:"ml-3 text-sm text-gray-800",children:b})]},c))}),"CHECKBOX"===a.type&&(()=>{let b=a.options.some(a=>/target/i.test(a)),c=a.options.some(a=>/actions to be implemented/i.test(a));if(!(b||c)){let b=j[a.id]?j[a.id].split(",").map(a=>a.trim()):[];return(0,d.jsx)("div",{className:"space-y-3",children:a.options.map((c,e)=>(0,d.jsxs)("label",{className:"flex items-center",children:[(0,d.jsx)("input",{type:"checkbox",checked:b.includes(c),onChange:b=>E(a.id,c,b.target.checked),className:"h-4 w-4 accent-indigo-600 focus:ring-indigo-500 border-gray-300 rounded",disabled:!p}),(0,d.jsx)("span",{className:"ml-3 text-sm text-gray-800",children:c})]},e))})}let e={selected:[],details:{}};try{e=j[a.id]?JSON.parse(j[a.id]):e,Array.isArray(e.selected)||(e.selected=[]),("object"!=typeof e.details||null===e.details)&&(e.details={})}catch(b){e={selected:j[a.id]?j[a.id].split(",").map(a=>a.trim()).filter(Boolean):[],details:{}}}return(0,d.jsx)("div",{className:"space-y-4",children:a.options.map((b,c)=>(0,d.jsxs)("div",{children:[(0,d.jsxs)("label",{className:"flex items-center",children:[(0,d.jsx)("input",{type:"checkbox",checked:(e.selected||[]).includes(b),onChange:c=>E(a.id,b,c.target.checked),className:"h-4 w-4 accent-indigo-600 focus:ring-indigo-500 border-gray-300 rounded",disabled:!p}),(0,d.jsx)("span",{className:"ml-3 text-sm text-gray-800",children:b})]}),(/target/i.test(b)||/actions to be implemented/i.test(b))&&(0,d.jsx)("div",{className:"mt-2 ml-7",children:(0,d.jsx)("textarea",{value:e.details&&e.details[b]||"",onChange:c=>((b,c)=>{if(!p)return;let d=JSON.stringify({selected:Array.from(new Set([...e.selected||[],b])),details:{...e.details||{},[b]:c}});k(b=>({...b,[a.id]:d})),C({answers:[{questionId:a.id,answer:d}],selfComment:void 0})})(b,c.target.value),rows:3,className:"block w-full rounded-lg border border-gray-300 bg-white/90 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm px-3 py-2",placeholder:/target/i.test(b)?"Enter your target...":"Describe actions to be implemented...",disabled:!p})})]},c))})})()]})]})},a.id)),(0,d.jsxs)("div",{className:"bg-indigo-50/60 rounded-xl p-6 border border-indigo-100",children:[(0,d.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Self-Assessment Comment"}),(0,d.jsxs)("p",{className:"text-sm text-gray-600 mb-4",children:["Please provide additional comments about your ",a.toLowerCase()," of year evaluation:"]}),(0,d.jsx)("textarea",{value:l,onChange:a=>{m(a.target.value),C({answers:void 0,selfComment:a.target.value})},rows:6,className:"block w-full rounded-lg border border-indigo-200 bg-white/90 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm px-3 py-2",placeholder:"Share your thoughts, challenges, achievements, and goals...",disabled:!p,required:!0}),(0,d.jsxs)("div",{className:"mt-2 text-xs text-gray-500 h-4",children:["saving"===v&&"Saving...","saved"===v&&"Saved","error"===v&&"Auto-save failed"]})]})]}),p&&(0,d.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-end gap-3 mt-8 pt-6 border-t border-gray-100",children:[(0,d.jsxs)("div",{className:"flex items-center text-xs text-gray-500 mr-auto sm:mr-0",children:["Last saved: ","saving"===v?"saving...":"a moment ago"]}),(0,d.jsx)("button",{type:"button",onClick:()=>C({answers:Object.entries(j).map(([a,b])=>({questionId:a,answer:b})),selfComment:l}),className:"px-4 py-2 text-sm font-medium bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors border-0",children:"Save Draft"}),(0,d.jsx)("button",{type:"submit",disabled:g,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:g?"Submitting...":"Submit Evaluation"})]}),n&&(0,d.jsx)("div",{className:"mt-8 pt-6 border-t border-gray-200 text-sm text-green-700",children:"Submitted."})]})]})})}},64981:(a,b,c)=>{c.d(b,{A:()=>i});var d=c(60687),e=c(82136),f=c(16189);c(43210);var g=c(95758);function h({allowedRoles:a,children:b,fallback:c=(0,d.jsx)("div",{children:"Access denied. You don't have permission to view this page."})}){let{data:g,status:h}=(0,e.useSession)();if((0,f.useRouter)(),"loading"===h)return(0,d.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,d.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});let i=g?.user?.role;return g&&i&&a.includes(i)?(0,d.jsx)(d.Fragment,{children:b}):(0,d.jsx)(d.Fragment,{children:c})}function i(a){return(0,d.jsx)(g.PageErrorBoundary,{pageName:"Role Guard",children:(0,d.jsx)(h,{...a})})}}};