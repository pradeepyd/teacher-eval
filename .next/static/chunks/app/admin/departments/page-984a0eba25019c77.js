(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9694],{2166:(e,t,a)=>{Promise.resolve().then(a.bind(a,86224))},17580:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(19946).A)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]])},56287:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(19946).A)("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]])},57380:(e,t,a)=>{"use strict";a.d(t,{lG:()=>l,Cf:()=>m,rr:()=>g,Es:()=>h,c7:()=>u,L3:()=>p,zM:()=>d});var s=a(95155);a(12115);var r=a(15452);let n=(0,a(19946).A)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);var i=a(59434);function l(e){let{...t}=e;return(0,s.jsx)(r.bL,{"data-slot":"dialog",...t})}function d(e){let{...t}=e;return(0,s.jsx)(r.l9,{"data-slot":"dialog-trigger",...t})}function c(e){let{...t}=e;return(0,s.jsx)(r.ZL,{"data-slot":"dialog-portal",...t})}function o(e){let{className:t,...a}=e;return(0,s.jsx)(r.hJ,{"data-slot":"dialog-overlay",className:(0,i.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...a})}function m(e){let{className:t,children:a,showCloseButton:l=!0,...d}=e;return(0,s.jsxs)(c,{"data-slot":"dialog-portal",children:[(0,s.jsx)(o,{}),(0,s.jsxs)(r.UC,{"data-slot":"dialog-content",className:(0,i.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...d,children:[a,l&&(0,s.jsxs)(r.bm,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,s.jsx)(n,{}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function u(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"dialog-header",className:(0,i.cn)("flex flex-col gap-2 text-center sm:text-left",t),...a})}function h(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"dialog-footer",className:(0,i.cn)("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...a})}function p(e){let{className:t,...a}=e;return(0,s.jsx)(r.hE,{"data-slot":"dialog-title",className:(0,i.cn)("text-lg leading-none font-semibold",t),...a})}function g(e){let{className:t,...a}=e;return(0,s.jsx)(r.VY,{"data-slot":"dialog-description",className:(0,i.cn)("text-muted-foreground text-sm",t),...a})}},69074:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(19946).A)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])},86224:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>T});var s=a(95155),r=a(12115),n=a(12108),i=a(79783),l=a(12638),d=a(15080),c=a(88489),o=a(66695),m=a(30285),u=a(62523),h=a(26126),p=a(37349),g=a(55365),x=a(51154),f=a(84616),j=a(56287),y=a(62525),v=a(17580),N=a(69074),w=a(57380),b=a(59409),E=a(91462);function A(){let{data:e}=(0,n.useSession)(),t=(0,E.f)(),[a,d]=(0,r.useState)(!1),[A,T]=(0,r.useState)(""),[D,k]=(0,r.useState)(null),[S,C]=(0,r.useState)(null),[R,O]=(0,r.useState)(null),[F,H]=(0,r.useState)(""),[U,_]=(0,r.useState)(null),[P,L]=(0,r.useState)(!1),[M,z]=(0,r.useState)(""),[I,V]=(0,r.useState)([]),{departments:$=[],users:W=[],refetch:Z,loading:J=!1,createDepartment:B,updateDepartment:K,deleteDepartment:q,assignHod:X,assignTeachers:G}=t||{},Y=(0,c.jX)(W).map(e=>(0,c.NV)(e)),Q=(0,c.jX)($).map(e=>(0,c.se)(e));if(!(null==e?void 0:e.user))return(0,s.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,s.jsx)(x.A,{className:"w-8 h-8 animate-spin"})});if(J)return(0,s.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})});let ee=async e=>{e.preventDefault();let t=(0,c.nr)(A).trim();if(t){d(!0),k(null),C(null);try{if(!B)throw Error("Department creation is not available at the moment");await B({name:t}),C("Department created successfully!"),T(""),L(!1),Z&&Z()}catch(e){k(e instanceof Error?e.message:"Failed to create department"),console.error("Error creating department:",e)}finally{d(!1)}}},et=async()=>{if(R&&F.trim()){d(!0),k(null),C(null);try{await K(R,{name:F.trim()}),C("Department updated successfully!"),O(null),H(""),Z()}catch(e){k(e instanceof Error?e.message:"Failed to update department")}finally{d(!1)}}},ea=async()=>{if(U){d(!0),k(null),C(null);try{await q(U),C("Department deleted successfully!"),_(null),Z()}catch(e){k(e instanceof Error?e.message:"Failed to delete department")}finally{d(!1)}}},es=async()=>{if(M){d(!0),k(null),C(null);try{await X(M,M),C("HOD assigned successfully!"),z(""),Z()}catch(e){k(e instanceof Error?e.message:"Failed to assign HOD")}finally{d(!1)}}},er=async()=>{if(0!==I.length){d(!0),k(null),C(null);try{await G(I[0],I),C("Teachers assigned successfully!"),V([]),Z()}catch(e){k(e instanceof Error?e.message:"Failed to assign teachers")}finally{d(!1)}}},en=e=>Y.find(t=>{var a;return(null==(a=t.department)?void 0:a.id)===e&&"HOD"===t.role});return(0,s.jsx)(i.A,{allowedRoles:["ADMIN"],children:(0,s.jsxs)(l.A,{title:"Department Management",children:[(0,s.jsx)("div",{className:"mb-6",children:(0,s.jsx)(o.Zp,{className:"bg-gradient-to-r from-green-50 to-blue-100",children:(0,s.jsx)(o.Wu,{className:"py-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("h2",{className:"text-xl font-semibold text-gray-900",children:["Welcome, ",e.user.name,"!"]}),(0,s.jsx)("p",{className:"text-gray-600",children:"Department Management Dashboard"})]}),(0,s.jsx)(h.E,{variant:"outline",className:"text-base",children:"Admin"})]})})})}),D&&(0,s.jsx)(g.Fc,{className:"mb-4 border-red-200 bg-red-50",children:(0,s.jsx)(g.TN,{className:"text-red-800",children:D})}),S&&(0,s.jsx)(g.Fc,{className:"mb-4 border-green-200 bg-green-50",children:(0,s.jsx)(g.TN,{className:"text-green-800",children:S})}),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("h3",{className:"text-lg font-semibold",children:["Departments (",Q.length,")"]}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Manage academic departments and their staff"})]}),(0,s.jsxs)(w.lG,{open:P,onOpenChange:L,children:[(0,s.jsx)(w.zM,{asChild:!0,children:(0,s.jsxs)(m.$,{onClick:()=>T(""),children:[(0,s.jsx)(f.A,{className:"h-4 w-4 mr-2"}),"Add Department"]})}),(0,s.jsxs)(w.Cf,{children:[(0,s.jsxs)(w.c7,{children:[(0,s.jsx)(w.L3,{children:"Add New Department"}),(0,s.jsx)(w.rr,{children:"Create a new academic department"})]}),(0,s.jsxs)("form",{onSubmit:ee,children:[(0,s.jsx)("div",{className:"grid gap-4 py-4",children:(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)("label",{htmlFor:"name",className:"text-sm font-medium",children:"Department Name"}),(0,s.jsx)(u.p,{id:"name",value:A,onChange:e=>T(e.target.value),placeholder:"Enter department name",disabled:a})]})}),(0,s.jsxs)(w.Es,{children:[(0,s.jsx)(m.$,{type:"button",variant:"outline",onClick:()=>L(!1),disabled:a,children:"Cancel"}),(0,s.jsx)(m.$,{type:"submit",disabled:a||!A.trim(),children:a?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.A,{className:"h-4 w-4 animate-spin mr-2"}),"Creating..."]}):"Create Department"})]})]})]})]})]}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Q.map(e=>{var t,r,n,i,l;let d;return(0,s.jsxs)(o.Zp,{className:"hover:shadow-lg transition-all duration-200",children:[(0,s.jsxs)(o.aR,{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)(o.ZB,{className:"text-lg",children:e.name}),(0,s.jsx)(h.E,{variant:(null==(r=e.termStates)||null==(t=r[0])?void 0:t.activeTerm)==="START"?"default":"secondary",children:(null==(i=e.termStates)||null==(n=i[0])?void 0:n.activeTerm)||"INACTIVE"})]}),(0,s.jsxs)(o.BT,{children:["Created ",new Date(e.createdAt).toLocaleDateString()]})]}),(0,s.jsxs)(o.Wu,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Total Users:"}),(0,s.jsx)("span",{className:"font-medium",children:(null==(l=e._count)?void 0:l.users)||0})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"HOD:"}),(0,s.jsx)("span",{className:"font-medium",children:(()=>{var t;let a=en(e.id);return a?"".concat(a.name," (").concat(a.email,")"):(null==(t=e.hod)?void 0:t.name)||"Not assigned"})()})]}),(()=>{let t=en(e.id);return t?(0,s.jsxs)("div",{className:"text-xs text-muted-foreground bg-gray-50 p-2 rounded",children:[(0,s.jsxs)("div",{children:["HOD Email: ",t.email]}),(0,s.jsxs)("div",{children:["Role: ",t.role]})]}):null})(),(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Teachers:"}),(0,s.jsx)("span",{className:"font-medium",children:(d=e.id,Y.filter(e=>{var t;return(null==(t=e.department)?void 0:t.id)===d&&"TEACHER"===e.role})).length})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 pt-2",children:[(0,s.jsxs)(m.$,{variant:"outline",size:"sm",onClick:()=>{O((0,c.nr)(e.id)),H((0,c.nr)(e.name))},disabled:a,className:"flex-1",children:[(0,s.jsx)(j.A,{className:"h-4 w-4 mr-1"}),"Edit"]}),(0,s.jsxs)(p.Lt,{children:[(0,s.jsx)(p.tv,{asChild:!0,children:(0,s.jsxs)(m.$,{variant:"outline",size:"sm",onClick:()=>_(e.id),disabled:a,className:"flex-1",children:[(0,s.jsx)(y.A,{className:"h-4 w-4 mr-1"}),"Delete"]})}),(0,s.jsxs)(p.EO,{children:[(0,s.jsxs)(p.wd,{children:[(0,s.jsx)(p.r7,{children:"Delete Department"}),(0,s.jsxs)(p.$v,{children:["Are you sure you want to delete ",e.name,"? This action cannot be undone."]})]}),(0,s.jsxs)(p.ck,{children:[(0,s.jsx)(p.Zr,{disabled:a,children:"Cancel"}),(0,s.jsx)(p.Rx,{onClick:ea,disabled:a,children:a?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.A,{className:"h-4 w-4 animate-spin mr-2"}),"Deleting..."]}):"Delete"})]})]})]})]})]})]},e.id)})}),R&&(0,s.jsx)(w.lG,{open:!!R,onOpenChange:()=>O(null),children:(0,s.jsxs)(w.Cf,{children:[(0,s.jsxs)(w.c7,{children:[(0,s.jsx)(w.L3,{children:"Edit Department"}),(0,s.jsx)(w.rr,{children:"Update department information"})]}),(0,s.jsx)("div",{className:"grid gap-4 py-4",children:(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)("label",{htmlFor:"editName",className:"text-sm font-medium",children:"Department Name"}),(0,s.jsx)(u.p,{id:"editName",value:F,onChange:e=>H(e.target.value),placeholder:"Enter department name",disabled:a})]})}),(0,s.jsxs)(w.Es,{children:[(0,s.jsx)(m.$,{variant:"outline",onClick:()=>O(null),disabled:a,children:"Cancel"}),(0,s.jsx)(m.$,{onClick:et,disabled:a||!F.trim(),children:a?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.A,{className:"h-4 w-4 animate-spin mr-2"}),"Updating..."]}):"Update Department"})]})]})}),(0,s.jsxs)(o.Zp,{children:[(0,s.jsxs)(o.aR,{children:[(0,s.jsxs)(o.ZB,{className:"flex items-center gap-2",children:[(0,s.jsx)(v.A,{className:"h-5 w-5"}),"Assign HOD to Department"]}),(0,s.jsx)(o.BT,{children:"Assign a Head of Department to manage a department"})]}),(0,s.jsx)(o.Wu,{children:(0,s.jsxs)("div",{className:"flex gap-4 items-end",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Select HOD"}),(0,s.jsxs)(b.l6,{value:M,onValueChange:z,children:[(0,s.jsx)(b.bq,{children:(0,s.jsx)(b.yv,{placeholder:"Choose a HOD"})}),(0,s.jsx)(b.gC,{children:Y.filter(e=>"HOD"===e.role).map(e=>(0,s.jsxs)(b.eb,{value:e.id,children:[e.name," (",e.email,")"]},e.id))})]})]}),(0,s.jsx)(m.$,{onClick:es,disabled:!M||a,children:a?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.A,{className:"h-4 w-4 animate-spin mr-2"}),"Assigning..."]}):"Assign HOD"})]})})]}),(0,s.jsxs)(o.Zp,{children:[(0,s.jsxs)(o.aR,{children:[(0,s.jsxs)(o.ZB,{className:"flex items-center gap-2",children:[(0,s.jsx)(N.A,{className:"h-5 w-5"}),"Assign Teachers to Department"]}),(0,s.jsx)(o.BT,{children:"Assign teachers to specific departments"})]}),(0,s.jsx)(o.Wu,{children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Select Teachers"}),(0,s.jsxs)(b.l6,{value:"",onValueChange:e=>{I.includes(e)||V([...I,e])},children:[(0,s.jsx)(b.bq,{children:(0,s.jsx)(b.yv,{placeholder:"Choose teachers to assign"})}),(0,s.jsx)(b.gC,{children:Y.filter(e=>"TEACHER"===e.role&&!e.department).map(e=>(0,s.jsxs)(b.eb,{value:e.id,children:[e.name," (",e.email,")"]},e.id))})]})]}),I.length>0&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Selected Teachers:"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:I.map(e=>{let t=Y.find(t=>t.id===e);return t?(0,s.jsxs)(h.E,{variant:"secondary",className:"flex items-center gap-1",children:[t.name,(0,s.jsx)(m.$,{variant:"ghost",size:"sm",className:"h-4 w-4 p-0 ml-1",onClick:()=>V(I.filter(t=>t!==e)),children:"\xd7"})]},e):null})})]}),(0,s.jsx)(m.$,{onClick:er,disabled:0===I.length||a,children:a?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.A,{className:"h-4 w-4 animate-spin mr-2"}),"Assigning..."]}):"Assign Teachers"})]})})]})]})]})})}function T(){return(0,s.jsx)(d.PageErrorBoundary,{pageName:"Departments",children:(0,s.jsx)(d.r0,{dataType:"department data",children:(0,s.jsx)(A,{})})})}},88489:(e,t,a)=>{"use strict";function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Array.isArray(e)?e:t}function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return"string"==typeof e?e:t}function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=Number(e);return!isNaN(a)&&isFinite(a)?a:t}function i(e,t,a){if(!e||"object"!=typeof e)return a;let s={...a};for(let[a,r]of Object.entries(t))if(a in e){let t=e[a];"string"==typeof r&&"string"==typeof t||"number"==typeof r&&"number"==typeof t||"boolean"==typeof r&&"boolean"==typeof t||Array.isArray(r)&&Array.isArray(t)?s[a]=t:r&&"object"==typeof r&&t&&"object"==typeof t&&(s[a]=t)}return s}function l(e){var t,a;return{id:r(null==e?void 0:e.id)||"",name:r(null==e?void 0:e.name)||"Unknown User",email:r(null==e?void 0:e.email)||"",role:r(null==e?void 0:e.role)||"TEACHER",department:(null==e?void 0:e.department)?{id:r(null==(t=e.department)?void 0:t.id),name:r(null==(a=e.department)?void 0:a.name)}:null}}function d(e){var t,a,l;return{id:r(null==e?void 0:e.id)||"",name:r(null==e?void 0:e.name)||"Unknown Department",createdAt:r(null==e?void 0:e.createdAt)||new Date().toISOString(),updatedAt:r(null==e?void 0:e.updatedAt)||new Date().toISOString(),hod:(null==e?void 0:e.hod)?{id:r(null==(t=e.hod)?void 0:t.id),name:r(null==(a=e.hod)?void 0:a.name)}:void 0,termStates:s(null==e?void 0:e.termStates).map(e=>i(e,{activeTerm:"START",startTermVisibility:"",endTermVisibility:""},{activeTerm:"START",startTermVisibility:"HIDDEN",endTermVisibility:"HIDDEN"})),_count:{users:n(null==e||null==(l=e._count)?void 0:l.users)||0}}}function c(e){return i(e,{id:"",type:"",message:"",department:null,timestamp:""},{id:"",type:"UNKNOWN",message:"Unknown activity",department:null,timestamp:new Date().toISOString()})}a.d(t,{Ju:()=>n,NV:()=>l,jX:()=>s,nr:()=>r,se:()=>d,zX:()=>c})},91462:(e,t,a)=>{"use strict";a.d(t,{f:()=>c});var s=a(12115),r=a(12108);class n{static createError(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"An unexpected error occurred";if(e instanceof TypeError&&e.message.includes("fetch"))return{message:"Network error. Please check your connection and try again.",code:"NETWORK_ERROR",status:0};if(e instanceof Response)return{message:"Server error (".concat(e.status,"). Please try again later."),code:"HTTP_ERROR",status:e.status};if(e&&"object"==typeof e){if(e.message)return{message:String(e.message),code:e.code,status:e.status,details:e.details};if(e.error)return{message:String(e.error),code:e.code,status:e.status}}return"string"==typeof e?{message:e,code:"UNKNOWN_ERROR"}:{message:t,code:"UNKNOWN_ERROR"}}static async handleResponse(e){try{if(!e.ok){let t="HTTP ".concat(e.status),a=null;try{let s=await e.json();t=s.error||s.message||t,a=s.details||s}catch(a){t=e.statusText||t}throw this.createError({message:t,status:e.status,details:a})}return await e.json()}catch(e){if(e&&"object"==typeof e&&"message"in e&&"code"in e)throw e;throw this.createError(e,"Failed to process server response")}}static logError(e,t){t?"[".concat(t,"] ").concat(e.message):e.message}static getUserFriendlyMessage(e){switch(e.code){case"NETWORK_ERROR":return"Unable to connect. Please check your internet connection.";case"HTTP_ERROR":if(401===e.status)return"Please log in to continue.";if(403===e.status)return"You do not have permission to perform this action.";if(404===e.status)return"The requested resource was not found.";if(500===e.status)return"Server error. Please try again later.";return"Something went wrong. Please try again.";case"VALIDATION_ERROR":return e.message;default:if(e.message&&e.message.length<100&&!e.message.includes("Error:"))return e.message;return"Something went wrong. Please try again."}}}async function i(e,t){try{let t=await e();return await n.handleResponse(t)}catch(a){let e=n.createError(a);throw n.logError(e,t),e}}async function l(e,t,a){return i(()=>fetch(e,t),a||"API call to ".concat(e))}let d={users:null,departments:null,stats:null,activities:null,isLoading:!1,hasData:!1};function c(){let{data:e,status:t}=(0,r.useSession)(),[a,i]=(0,s.useState)(!1),[c,o]=(0,s.useState)(null),m=(0,s.useCallback)(async()=>{if(!d.isLoading&&!d.hasData){d.isLoading=!0,i(!0),o(null);try{var e,t,a;let s,[r,n,i]=await Promise.all([l("/api/admin/users",void 0,"Admin: fetch users"),l("/api/departments",void 0,"Admin: fetch departments"),l("/api/admin/activity",void 0,"Admin: fetch activities")]),c=Array.isArray(null==r||null==(e=r.data)?void 0:e.users)?r.data.users:[],o=Array.isArray(null==n||null==(t=n.data)?void 0:t.departments)?n.data.departments.map(e=>{var t;return{...e,termStates:e.termStates||[],_count:{users:(null==(t=e._count)?void 0:t.users)||0}}}):[],m=Array.isArray(null==i||null==(a=i.data)?void 0:a.activities)?i.data.activities:[];try{let e=await l("/api/admin/stats",void 0,"Admin: fetch stats");console.log("Admin stats response:",e),s=(null==e?void 0:e.stats)||{totalUsers:c.length,totalTeachers:c.filter(e=>"TEACHER"===e.role).length,totalDepartments:o.length,activeEvaluations:0,completedReviews:0,pendingReviews:0}}catch(e){console.error("Failed to fetch admin stats, using fallback:",e),s={totalUsers:c.length,totalTeachers:c.filter(e=>"TEACHER"===e.role).length,totalDepartments:o.length,activeEvaluations:0,completedReviews:0,pendingReviews:0}}d={users:c,departments:o,stats:s,activities:m,isLoading:!1,hasData:!0}}catch(t){let e=n.createError(t,"Failed to load admin dashboard data");o(n.getUserFriendlyMessage(e)),d.isLoading=!1,d.users=[],d.departments=[],d.stats={totalUsers:0,totalTeachers:0,totalDepartments:0,activeEvaluations:0,completedReviews:0,pendingReviews:0},d.activities=[]}finally{i(!1)}}},[]),u=(0,s.useCallback)(()=>{d.hasData=!1,d.users=null,d.departments=null,d.stats=null,d.activities=null},[]),h=(0,s.useCallback)(()=>{u(),m()},[m,u]);(0,s.useEffect)(()=>{var a;"authenticated"!==t||(null==e||null==(a=e.user)?void 0:a.role)!=="ADMIN"||d.hasData||m()},[t,e,m]),(0,s.useEffect)(()=>{"unauthenticated"===t&&u()},[t,u]);let p=Array.isArray(d.users)?d.users:[],g=Array.isArray(d.departments)?d.departments.map(e=>{var t;return{...e,termStates:e.termStates||[],_count:{users:(null==(t=e._count)?void 0:t.users)||0}}}):[];return{users:p,departments:g,stats:d.stats||{totalUsers:0,totalTeachers:0,totalDepartments:0,activeEvaluations:0,completedReviews:0,pendingReviews:0},activities:Array.isArray(d.activities)?d.activities:[],loading:a||d.isLoading,error:c,refetch:h,invalidateCache:u,createUser:async e=>{try{return await l("/api/admin/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},"Admin: create user")}catch(e){throw n.createError(e,"Failed to create user")}},updateUser:async(e,t)=>{try{let a=await fetch("/api/admin/users/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok)throw Error("Failed to update user");return await a.json()}catch(e){throw n.createError(e,"Failed to update user")}},deleteUser:async e=>{try{let t=await fetch("/api/admin/users/".concat(e),{method:"DELETE"});if(!t.ok)throw Error("Failed to delete user");await t.json()}catch(e){throw n.createError(e,"Failed to delete user")}},createDepartment:async e=>{try{let t=await fetch("/api/departments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("Failed to create department");return await t.json()}catch(e){throw n.createError(e,"Failed to create department")}},updateDepartment:async(e,t)=>{try{let a=await fetch("/api/departments/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok)throw Error("Failed to update department");return await a.json()}catch(e){throw n.createError(e,"Failed to update department")}},deleteDepartment:async e=>{try{let t=await fetch("/api/departments/".concat(e),{method:"DELETE"});if(!t.ok)throw Error("Failed to delete department");await t.json()}catch(e){throw n.createError(e,"Failed to delete department")}},assignHod:async(e,t)=>{try{let a=await fetch("/api/departments/".concat(e,"/assign-hod"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({hodId:t})});if(!a.ok)throw Error("Failed to assign HOD");await a.json()}catch(e){throw n.createError(e,"Failed to assign HOD")}},assignTeachers:async(e,t)=>{try{let a=await fetch("/api/departments/assign-teachers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({departmentId:e,teacherIds:t})});if(!a.ok)throw Error("Failed to assign teachers");await a.json()}catch(e){throw n.createError(e,"Failed to assign teachers")}}}}}},e=>{e.O(0,[6169,2108,699,7754,6304,1438,8892,5244,8441,5964,7358],()=>e(e.s=2166)),_N_E=e.O()}]);