(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8733],{5040:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(19946).A)("book-open",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]])},17580:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(19946).A)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]])},43429:(e,t,a)=>{Promise.resolve().then(a.bind(a,65942))},47924:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(19946).A)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]])},57380:(e,t,a)=>{"use strict";a.d(t,{lG:()=>i,Cf:()=>m,rr:()=>x,Es:()=>h,c7:()=>u,L3:()=>p,zM:()=>d});var s=a(95155);a(12115);var r=a(15452);let l=(0,a(19946).A)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);var n=a(59434);function i(e){let{...t}=e;return(0,s.jsx)(r.bL,{"data-slot":"dialog",...t})}function d(e){let{...t}=e;return(0,s.jsx)(r.l9,{"data-slot":"dialog-trigger",...t})}function o(e){let{...t}=e;return(0,s.jsx)(r.ZL,{"data-slot":"dialog-portal",...t})}function c(e){let{className:t,...a}=e;return(0,s.jsx)(r.hJ,{"data-slot":"dialog-overlay",className:(0,n.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...a})}function m(e){let{className:t,children:a,showCloseButton:i=!0,...d}=e;return(0,s.jsxs)(o,{"data-slot":"dialog-portal",children:[(0,s.jsx)(c,{}),(0,s.jsxs)(r.UC,{"data-slot":"dialog-content",className:(0,n.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...d,children:[a,i&&(0,s.jsxs)(r.bm,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,s.jsx)(l,{}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function u(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"dialog-header",className:(0,n.cn)("flex flex-col gap-2 text-center sm:text-left",t),...a})}function h(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"dialog-footer",className:(0,n.cn)("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...a})}function p(e){let{className:t,...a}=e;return(0,s.jsx)(r.hE,{"data-slot":"dialog-title",className:(0,n.cn)("text-lg leading-none font-semibold",t),...a})}function x(e){let{className:t,...a}=e;return(0,s.jsx)(r.VY,{"data-slot":"dialog-description",className:(0,n.cn)("text-muted-foreground text-sm",t),...a})}},65942:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>S});var s=a(95155),r=a(12115),l=a(12108),n=a(79783),i=a(12638),d=a(66695),o=a(26126),c=a(85127),m=a(30285),u=a(62523),h=a(59409),p=a(57380),x=a(37349),f=a(55365),g=a(51154),j=a(19946);let y=(0,j.A)("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),v=(0,j.A)("graduation-cap",[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]]),w=(0,j.A)("user-check",[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]);var N=a(5040),b=a(17580),A=a(47924),E=a(84616);let k=(0,j.A)("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);var C=a(62525),R=a(91462);function S(){let{data:e}=(0,l.useSession)(),t=(0,R.f)(),[a,j]=(0,r.useState)(!1),[S,D]=(0,r.useState)(null),[T,U]=(0,r.useState)(null),[F,M]=(0,r.useState)(1),[O,P]=(0,r.useState)(""),[_,I]=(0,r.useState)(!1),[L,H]=(0,r.useState)(null),[z,q]=(0,r.useState)(null),[$,J]=(0,r.useState)({name:"",email:"",role:"",departmentId:"",password:""}),[V,W]=(0,r.useState)([]);if(!t||"object"!=typeof t)return(0,s.jsx)(n.A,{allowedRoles:["ADMIN"],children:(0,s.jsx)(i.A,{title:"User Management",children:(0,s.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})})})});let{users:Z,departments:B,refetch:K,loading:G,createUser:X,updateUser:Y,deleteUser:Q}=t,ee=Z||[],et=B||[];if(!(null==e?void 0:e.user))return(0,s.jsx)(n.A,{allowedRoles:["ADMIN"],children:(0,s.jsx)(i.A,{title:"User Management",children:(0,s.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,s.jsx)(g.A,{className:"w-8 h-8 animate-spin"})})})});if(G||!Array.isArray(ee)||!Array.isArray(et))return(0,s.jsx)(n.A,{allowedRoles:["ADMIN"],children:(0,s.jsx)(i.A,{title:"User Management",children:(0,s.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})})})});let ea=async()=>{if(!$.name.trim()||!$.email.trim()||!$.role)return void D("Please fill in all required fields");if(V.length>0)return void D("Please fix password validation errors before adding user");j(!0),D(null),U(null);try{let e=await X({name:$.name.trim(),email:$.email.trim(),role:$.role,departmentId:$.departmentId||void 0,password:$.password.trim()});if(e&&"object"==typeof e&&"id"in e)U("User added successfully!"),K(),I(!1),el();else throw Error("Invalid response from server");U("User added successfully!"),K(),I(!1),el()}catch(e){D(e instanceof Error?e.message:"Failed to add user")}finally{j(!1)}},es=async()=>{if(L){if(!$.name.trim()||!$.email.trim()||!$.role)return void D("Please fill in all required fields");if($.password.trim()&&V.length>0)return void D("Please fix password validation errors before updating");j(!0),D(null),U(null);try{let e=await Y(L.id,{name:$.name.trim(),email:$.email.trim(),role:$.role,departmentId:$.departmentId||void 0});if(e&&"object"==typeof e&&"id"in e)U("User updated successfully!"),K(),I(!1),el();else throw Error("Invalid response from server");U("User updated successfully!"),K(),I(!1),el()}catch(e){D(e instanceof Error?e.message:"Failed to update user")}finally{j(!1)}}},er=async()=>{if(z){j(!0),D(null);try{await Q(z.id),U("User deleted successfully!"),K(),q(null)}catch(e){D(e instanceof Error?e.message:"Failed to delete user")}finally{j(!1)}}},el=()=>{J({name:"",email:"",role:"",departmentId:"",password:""}),H(null),W([])},en=ee.filter(e=>e.name.toLowerCase().includes(O.toLowerCase())||e.email.toLowerCase().includes(O.toLowerCase())||e.role.toLowerCase().includes(O.toLowerCase())),ei=Math.ceil(en.length/10),ed=(F-1)*10,eo=en.slice(ed,ed+10);return(0,s.jsx)(n.A,{allowedRoles:["ADMIN"],children:(0,s.jsxs)(i.A,{title:"User Management",children:[(0,s.jsx)("div",{className:"mb-6",children:(0,s.jsx)(d.Zp,{className:"bg-gradient-to-r from-orange-50 to-red-100",children:(0,s.jsx)(d.Wu,{className:"py-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("h2",{className:"text-xl font-semibold text-gray-900",children:["Welcome, ",e.user.name,"!"]}),(0,s.jsx)("p",{className:"text-gray-600",children:"User Management Dashboard"})]}),(0,s.jsx)(o.E,{variant:"outline",className:"text-base",children:"Admin"})]})})})}),S&&(0,s.jsx)(f.Fc,{className:"mb-4 border-red-200 bg-red-50",children:(0,s.jsx)(f.TN,{className:"text-red-800",children:S})}),T&&(0,s.jsx)(f.Fc,{className:"mb-4 border-green-200 bg-green-50",children:(0,s.jsx)(f.TN,{className:"text-green-800",children:T})}),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 justify-between items-start sm:items-center",children:[(0,s.jsx)("div",{className:"flex-1 max-w-md",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(A.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),(0,s.jsx)(u.p,{placeholder:"Search users...",value:O,onChange:e=>P(e.target.value),className:"pl-10"})]})}),(0,s.jsxs)(p.lG,{open:_,onOpenChange:I,children:[(0,s.jsx)(p.zM,{asChild:!0,children:(0,s.jsxs)(m.$,{onClick:()=>el(),children:[(0,s.jsx)(E.A,{className:"h-4 w-4 mr-2"}),"Add User"]})}),(0,s.jsxs)(p.Cf,{className:"sm:max-w-[425px]",children:[(0,s.jsxs)(p.c7,{children:[(0,s.jsx)(p.L3,{children:L?"Edit User":"Add New User"}),(0,s.jsx)(p.rr,{children:L?"Update user information":"Create a new user account"})]}),(0,s.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)("label",{htmlFor:"name",className:"text-sm font-medium",children:"Name"}),(0,s.jsx)(u.p,{id:"name",value:$.name,onChange:e=>J({...$,name:e.target.value}),placeholder:"Enter full name",disabled:a})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)("label",{htmlFor:"email",className:"text-sm font-medium",children:"Email"}),(0,s.jsx)(u.p,{id:"email",type:"email",value:$.email,onChange:e=>J({...$,email:e.target.value}),placeholder:"Enter email address",disabled:a})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)("label",{htmlFor:"password",className:"text-sm font-medium",children:L?"New Password (leave blank to keep current)":"Password"}),(0,s.jsx)(u.p,{id:"password",type:"password",value:$.password,onChange:e=>{var t;return t=e.target.value,void(J({...$,password:t}),t.trim()?W((e=>{let t=[];return e.length<8&&t.push("Password must be at least 8 characters long"),/[0-9]/.test(e)||t.push("Password must contain at least one number"),t})(t)):W([]))},placeholder:L?"Enter new password or leave blank":"Enter password",disabled:a,className:V.length>0?"border-red-500":""}),V.length>0&&(0,s.jsxs)("div",{className:"text-xs text-red-600 space-y-1",children:[(0,s.jsx)("p",{className:"font-medium",children:"Password validation errors:"}),(0,s.jsx)("ul",{className:"list-disc list-inside space-y-0.5",children:V.map((e,t)=>(0,s.jsx)("li",{children:e},t))})]}),!L&&(0,s.jsxs)("div",{className:"text-xs text-gray-600 space-y-1",children:[(0,s.jsx)("p",{className:"font-medium",children:"Password must contain:"}),(0,s.jsxs)("ul",{className:"list-disc list-inside space-y-0.5",children:[(0,s.jsx)("li",{children:"At least 8 characters"}),(0,s.jsx)("li",{children:"One number (0-9)"})]})]}),L&&(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Only fill this field if you want to change the user's password"})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)("label",{htmlFor:"role",className:"text-sm font-medium",children:"Role"}),(0,s.jsxs)(h.l6,{value:$.role,onValueChange:e=>J({...$,role:e}),disabled:a,children:[(0,s.jsx)(h.bq,{children:(0,s.jsx)(h.yv,{placeholder:"Select role"})}),(0,s.jsxs)(h.gC,{children:[(0,s.jsx)(h.eb,{value:"TEACHER",children:"Teacher"}),(0,s.jsx)(h.eb,{value:"HOD",children:"Head of Department"}),(0,s.jsx)(h.eb,{value:"ASST_DEAN",children:"Assistant Dean"}),(0,s.jsx)(h.eb,{value:"DEAN",children:"Dean"}),(0,s.jsx)(h.eb,{value:"ADMIN",children:"Admin"})]})]})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)("label",{htmlFor:"department",className:"text-sm font-medium",children:"Department"}),(0,s.jsxs)(h.l6,{value:$.departmentId,onValueChange:e=>J({...$,departmentId:e}),disabled:a,children:[(0,s.jsx)(h.bq,{children:(0,s.jsx)(h.yv,{placeholder:"Select department"})}),(0,s.jsx)(h.gC,{children:et.map(e=>(0,s.jsx)(h.eb,{value:e.id,children:e.name},e.id))})]})]})]}),(0,s.jsxs)(p.Es,{children:[(0,s.jsx)(m.$,{variant:"outline",onClick:()=>I(!1),disabled:a,children:"Cancel"}),(0,s.jsx)(m.$,{onClick:L?es:ea,disabled:a||V.length>0,children:a?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(g.A,{className:"h-4 w-4 animate-spin mr-2"}),L?"Updating...":"Adding..."]}):L?"Update User":"Add User"})]})]})]})]}),(0,s.jsxs)(d.Zp,{children:[(0,s.jsxs)(d.aR,{children:[(0,s.jsxs)(d.ZB,{children:["Users (",en.length,")"]}),(0,s.jsx)(d.BT,{children:"Manage system users with pagination and search"})]}),(0,s.jsx)(d.Wu,{children:eo.length>0?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(c.XI,{children:[(0,s.jsx)(c.A0,{children:(0,s.jsxs)(c.Hj,{children:[(0,s.jsx)(c.nd,{children:"Name"}),(0,s.jsx)(c.nd,{children:"Email"}),(0,s.jsx)(c.nd,{children:"Role"}),(0,s.jsx)(c.nd,{children:"Department"}),(0,s.jsx)(c.nd,{children:"Status"}),(0,s.jsx)(c.nd,{children:"Actions"})]})}),(0,s.jsx)(c.BF,{children:eo.map(e=>{var t;return(0,s.jsxs)(c.Hj,{children:[(0,s.jsx)(c.nA,{className:"font-medium",children:e.name}),(0,s.jsx)(c.nA,{children:e.email}),(0,s.jsx)(c.nA,{children:(0,s.jsxs)(o.E,{variant:(e=>{switch(e){case"ADMIN":return"destructive";case"DEAN":return"default";case"ASST_DEAN":case"TEACHER":default:return"secondary";case"HOD":return"outline"}})(e.role),className:"flex items-center gap-1 w-fit",children:[(e=>{switch(e){case"ADMIN":return(0,s.jsx)(y,{className:"h-4 w-4"});case"DEAN":return(0,s.jsx)(v,{className:"h-4 w-4"});case"ASST_DEAN":return(0,s.jsx)(w,{className:"h-4 w-4"});case"HOD":return(0,s.jsx)(N.A,{className:"h-4 w-4"});default:return(0,s.jsx)(b.A,{className:"h-4 w-4"})}})(e.role),e.role.replace("_"," ")]})}),(0,s.jsx)(c.nA,{children:(null==(t=e.department)?void 0:t.name)||"No Department"}),(0,s.jsx)(c.nA,{children:(0,s.jsx)(o.E,{variant:"default",children:"Active"})}),(0,s.jsx)(c.nA,{children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(m.$,{variant:"outline",size:"sm",onClick:()=>{var t;H(e),J({name:e.name,email:e.email,role:e.role,departmentId:(null==(t=e.department)?void 0:t.id)||"",password:""}),W([]),I(!0)},disabled:a,children:(0,s.jsx)(k,{className:"h-4 w-4"})}),(0,s.jsxs)(x.Lt,{children:[(0,s.jsx)(x.tv,{asChild:!0,children:(0,s.jsx)(m.$,{variant:"outline",size:"sm",onClick:()=>q(e),disabled:a,children:(0,s.jsx)(C.A,{className:"h-4 w-4"})})}),(0,s.jsxs)(x.EO,{children:[(0,s.jsxs)(x.wd,{children:[(0,s.jsx)(x.r7,{children:"Delete User"}),(0,s.jsxs)(x.$v,{children:["Are you sure you want to delete ",e.name,"? This action cannot be undone."]})]}),(0,s.jsxs)(x.ck,{children:[(0,s.jsx)(x.Zr,{disabled:a,children:"Cancel"}),(0,s.jsx)(x.Rx,{onClick:er,disabled:a,children:a?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(g.A,{className:"h-4 w-4 animate-spin mr-2"}),"Deleting..."]}):"Delete"})]})]})]})]})})]},e.id)})})]}),ei>1&&(0,s.jsxs)("div",{className:"flex items-center justify-between mt-4",children:[(0,s.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Showing ",ed+1," to ",Math.min(ed+10,en.length)," of ",en.length," users"]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(m.$,{variant:"outline",size:"sm",onClick:()=>M(F-1),disabled:1===F,children:"Previous"}),(0,s.jsxs)("span",{className:"text-sm",children:["Page ",F," of ",ei]}),(0,s.jsx)(m.$,{variant:"outline",size:"sm",onClick:()=>M(F+1),disabled:F===ei,children:"Next"})]})]})]}):(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)(b.A,{className:"mx-auto h-12 w-12 text-muted-foreground"}),(0,s.jsx)("h3",{className:"mt-4 text-lg font-semibold",children:"No users found"}),(0,s.jsx)("p",{className:"mt-2 text-sm text-muted-foreground",children:O?"Try adjusting your search terms.":"Users will appear here once they register in the system."})]})})]})]})]})})}},85127:(e,t,a)=>{"use strict";a.d(t,{A0:()=>n,BF:()=>i,Hj:()=>d,XI:()=>l,nA:()=>c,nd:()=>o});var s=a(95155);a(12115);var r=a(59434);function l(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,s.jsx)("table",{"data-slot":"table",className:(0,r.cn)("w-full caption-bottom text-sm",t),...a})})}function n(e){let{className:t,...a}=e;return(0,s.jsx)("thead",{"data-slot":"table-header",className:(0,r.cn)("[&_tr]:border-b",t),...a})}function i(e){let{className:t,...a}=e;return(0,s.jsx)("tbody",{"data-slot":"table-body",className:(0,r.cn)("[&_tr:last-child]:border-0",t),...a})}function d(e){let{className:t,...a}=e;return(0,s.jsx)("tr",{"data-slot":"table-row",className:(0,r.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",t),...a})}function o(e){let{className:t,...a}=e;return(0,s.jsx)("th",{"data-slot":"table-head",className:(0,r.cn)("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...a})}function c(e){let{className:t,...a}=e;return(0,s.jsx)("td",{"data-slot":"table-cell",className:(0,r.cn)("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...a})}},91462:(e,t,a)=>{"use strict";a.d(t,{f:()=>o});var s=a(12115),r=a(12108);class l{static createError(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"An unexpected error occurred";if(e instanceof TypeError&&e.message.includes("fetch"))return{message:"Network error. Please check your connection and try again.",code:"NETWORK_ERROR",status:0};if(e instanceof Response)return{message:"Server error (".concat(e.status,"). Please try again later."),code:"HTTP_ERROR",status:e.status};if(e&&"object"==typeof e){if(e.message)return{message:String(e.message),code:e.code,status:e.status,details:e.details};if(e.error)return{message:String(e.error),code:e.code,status:e.status}}return"string"==typeof e?{message:e,code:"UNKNOWN_ERROR"}:{message:t,code:"UNKNOWN_ERROR"}}static async handleResponse(e){try{if(!e.ok){let t="HTTP ".concat(e.status),a=null;try{let s=await e.json();t=s.error||s.message||t,a=s.details||s}catch(a){t=e.statusText||t}throw this.createError({message:t,status:e.status,details:a})}return await e.json()}catch(e){if(e&&"object"==typeof e&&"message"in e&&"code"in e)throw e;throw this.createError(e,"Failed to process server response")}}static logError(e,t){t?"[".concat(t,"] ").concat(e.message):e.message}static getUserFriendlyMessage(e){switch(e.code){case"NETWORK_ERROR":return"Unable to connect. Please check your internet connection.";case"HTTP_ERROR":if(401===e.status)return"Please log in to continue.";if(403===e.status)return"You do not have permission to perform this action.";if(404===e.status)return"The requested resource was not found.";if(500===e.status)return"Server error. Please try again later.";return"Something went wrong. Please try again.";case"VALIDATION_ERROR":return e.message;default:if(e.message&&e.message.length<100&&!e.message.includes("Error:"))return e.message;return"Something went wrong. Please try again."}}}async function n(e,t){try{let t=await e();return await l.handleResponse(t)}catch(a){let e=l.createError(a);throw l.logError(e,t),e}}async function i(e,t,a){return n(()=>fetch(e,t),a||"API call to ".concat(e))}let d={users:null,departments:null,stats:null,activities:null,isLoading:!1,hasData:!1};function o(){let{data:e,status:t}=(0,r.useSession)(),[a,n]=(0,s.useState)(!1),[o,c]=(0,s.useState)(null),m=(0,s.useCallback)(async()=>{if(!d.isLoading&&!d.hasData){d.isLoading=!0,n(!0),c(null);try{var e,t,a;let s,[r,l,n]=await Promise.all([i("/api/admin/users",void 0,"Admin: fetch users"),i("/api/departments",void 0,"Admin: fetch departments"),i("/api/admin/activity",void 0,"Admin: fetch activities")]),o=Array.isArray(null==r||null==(e=r.data)?void 0:e.users)?r.data.users:[],c=Array.isArray(null==l||null==(t=l.data)?void 0:t.departments)?l.data.departments.map(e=>{var t;return{...e,termStates:e.termStates||[],_count:{users:(null==(t=e._count)?void 0:t.users)||0}}}):[],m=Array.isArray(null==n||null==(a=n.data)?void 0:a.activities)?n.data.activities:[];try{let e=await i("/api/admin/stats",void 0,"Admin: fetch stats");console.log("Admin stats response:",e),s=(null==e?void 0:e.stats)||{totalUsers:o.length,totalTeachers:o.filter(e=>"TEACHER"===e.role).length,totalDepartments:c.length,activeEvaluations:0,completedReviews:0,pendingReviews:0}}catch(e){console.error("Failed to fetch admin stats, using fallback:",e),s={totalUsers:o.length,totalTeachers:o.filter(e=>"TEACHER"===e.role).length,totalDepartments:c.length,activeEvaluations:0,completedReviews:0,pendingReviews:0}}d={users:o,departments:c,stats:s,activities:m,isLoading:!1,hasData:!0}}catch(t){let e=l.createError(t,"Failed to load admin dashboard data");c(l.getUserFriendlyMessage(e)),d.isLoading=!1,d.users=[],d.departments=[],d.stats={totalUsers:0,totalTeachers:0,totalDepartments:0,activeEvaluations:0,completedReviews:0,pendingReviews:0},d.activities=[]}finally{n(!1)}}},[]),u=(0,s.useCallback)(()=>{d.hasData=!1,d.users=null,d.departments=null,d.stats=null,d.activities=null},[]),h=(0,s.useCallback)(()=>{u(),m()},[m,u]);(0,s.useEffect)(()=>{var a;"authenticated"!==t||(null==e||null==(a=e.user)?void 0:a.role)!=="ADMIN"||d.hasData||m()},[t,e,m]),(0,s.useEffect)(()=>{"unauthenticated"===t&&u()},[t,u]);let p=Array.isArray(d.users)?d.users:[],x=Array.isArray(d.departments)?d.departments.map(e=>{var t;return{...e,termStates:e.termStates||[],_count:{users:(null==(t=e._count)?void 0:t.users)||0}}}):[];return{users:p,departments:x,stats:d.stats||{totalUsers:0,totalTeachers:0,totalDepartments:0,activeEvaluations:0,completedReviews:0,pendingReviews:0},activities:Array.isArray(d.activities)?d.activities:[],loading:a||d.isLoading,error:o,refetch:h,invalidateCache:u,createUser:async e=>{try{return await i("/api/admin/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},"Admin: create user")}catch(e){throw l.createError(e,"Failed to create user")}},updateUser:async(e,t)=>{try{let a=await fetch("/api/admin/users/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok)throw Error("Failed to update user");return await a.json()}catch(e){throw l.createError(e,"Failed to update user")}},deleteUser:async e=>{try{let t=await fetch("/api/admin/users/".concat(e),{method:"DELETE"});if(!t.ok)throw Error("Failed to delete user");await t.json()}catch(e){throw l.createError(e,"Failed to delete user")}},createDepartment:async e=>{try{let t=await fetch("/api/departments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("Failed to create department");return await t.json()}catch(e){throw l.createError(e,"Failed to create department")}},updateDepartment:async(e,t)=>{try{let a=await fetch("/api/departments/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok)throw Error("Failed to update department");return await a.json()}catch(e){throw l.createError(e,"Failed to update department")}},deleteDepartment:async e=>{try{let t=await fetch("/api/departments/".concat(e),{method:"DELETE"});if(!t.ok)throw Error("Failed to delete department");await t.json()}catch(e){throw l.createError(e,"Failed to delete department")}},assignHod:async(e,t)=>{try{let a=await fetch("/api/departments/".concat(e,"/assign-hod"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({hodId:t})});if(!a.ok)throw Error("Failed to assign HOD");await a.json()}catch(e){throw l.createError(e,"Failed to assign HOD")}},assignTeachers:async(e,t)=>{try{let a=await fetch("/api/departments/assign-teachers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({departmentId:e,teacherIds:t})});if(!a.ok)throw Error("Failed to assign teachers");await a.json()}catch(e){throw l.createError(e,"Failed to assign teachers")}}}}}},e=>{e.O(0,[6169,2108,699,7754,6304,1438,8892,5244,8441,5964,7358],()=>e(e.s=43429)),_N_E=e.O()}]);