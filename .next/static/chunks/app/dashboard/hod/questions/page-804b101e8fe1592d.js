(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9699],{35695:(e,t,s)=>{"use strict";var l=s(18999);s.o(l,"useParams")&&s.d(t,{useParams:function(){return l.useParams}}),s.o(l,"useRouter")&&s.d(t,{useRouter:function(){return l.useRouter}})},42355:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});let l=(0,s(19946).A)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},63879:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>u});var l=s(95155),r=s(12115),a=s(12108),i=s(79783),n=s(12638);function o(e){let{onSubmit:t,onCancel:s,initialData:a,activeTerm:i,loading:n=!1}=e,[o,d]=(0,r.useState)((null==a?void 0:a.question)||""),[u,c]=(0,r.useState)((null==a?void 0:a.type)||"TEXT"),[m,x]=(0,r.useState)((null==a?void 0:a.term)||i),[h,f]=(0,r.useState)((null==a?void 0:a.options)||[""]),[b,p]=(0,r.useState)((null==a?void 0:a.order)||0),g=!!a;return(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,l.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:g?"Edit Question":"Create New Question"}),(0,l.jsxs)("form",{onSubmit:e=>{e.preventDefault();let s=h.filter(e=>""!==e.trim());if(("MCQ"===u||"CHECKBOX"===u)&&s.length<2)return void alert("MCQ and Checkbox questions must have at least 2 options");t({question:o.trim(),type:u,term:m,options:"MCQ"===u||"CHECKBOX"===u?s:void 0,order:b})},className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"question",className:"block text-sm font-medium text-gray-700",children:"Question Text"}),(0,l.jsx)("textarea",{id:"question",value:o,onChange:e=>d(e.target.value),rows:3,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",placeholder:"Enter your question here...",required:!0})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"type",className:"block text-sm font-medium text-gray-700",children:"Question Type"}),(0,l.jsxs)("select",{id:"type",value:u,onChange:e=>c(e.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",children:[(0,l.jsx)("option",{value:"TEXT",children:"Single Line Text"}),(0,l.jsx)("option",{value:"TEXTAREA",children:"Multi Line Text"}),(0,l.jsx)("option",{value:"MCQ",children:"Multiple Choice (Single)"}),(0,l.jsx)("option",{value:"CHECKBOX",children:"Multiple Choice (Multiple)"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"term",className:"block text-sm font-medium text-gray-700",children:"Term"}),(0,l.jsxs)("select",{id:"term",value:m,onChange:e=>x(e.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",disabled:g,children:[(0,l.jsx)("option",{value:"START",children:"Start of Year"}),(0,l.jsx)("option",{value:"END",children:"End of Year"})]}),m!==i&&(0,l.jsx)("p",{className:"mt-1 text-xs text-yellow-600",children:"Warning: This term is not currently active"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"order",className:"block text-sm font-medium text-gray-700",children:"Order"}),(0,l.jsx)("input",{type:"number",id:"order",value:b,onChange:e=>p(parseInt(e.target.value)||0),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",min:"0"})]})]}),("MCQ"===u||"CHECKBOX"===u)&&(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Answer Options"}),(0,l.jsxs)("div",{className:"space-y-2",children:[h.map((e,t)=>(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)("input",{type:"text",value:e,onChange:e=>((e,t)=>{let s=[...h];s[e]=t,f(s)})(t,e.target.value),placeholder:"Option ".concat(t+1),className:"flex-1 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"}),h.length>1&&(0,l.jsx)("button",{type:"button",onClick:()=>{f(h.filter((e,s)=>s!==t))},className:"px-3 py-2 text-red-600 hover:text-red-500",children:"Remove"})]},t)),(0,l.jsx)("button",{type:"button",onClick:()=>{f([...h,""])},className:"text-sm text-blue-600 hover:text-blue-500",children:"+ Add Option"})]})]}),(0,l.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,l.jsx)("button",{type:"button",onClick:s,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Cancel"}),(0,l.jsx)("button",{type:"submit",disabled:n||!o.trim(),className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:n?"Saving...":g?"Update Question":"Create Question"})]})]})]})}var d=s(56671);function u(){let{data:e}=(0,a.useSession)(),[t,s]=(0,r.useState)([]),[u,c]=(0,r.useState)(null),[m,x]=(0,r.useState)(!0),[h,f]=(0,r.useState)(!1),[b,p]=(0,r.useState)(null),[g,y]=(0,r.useState)(!1),[j,v]=(0,r.useState)(""),[N,w]=(0,r.useState)(""),[C,T]=(0,r.useState)("ALL"),E=async()=>{try{let e=await fetch("/api/questions");if(e.ok){let t=await e.json();s(t)}else v("Failed to fetch questions"),d.oR.error("Failed to fetch questions")}catch(e){v("Error fetching questions"),d.oR.error("Error fetching questions")}},S=async()=>{var t,s;if(null==e||null==(t=e.user)?void 0:t.departmentId)try{let t=await fetch("/api/departments/".concat(null==e||null==(s=e.user)?void 0:s.departmentId,"/term-state"));if(t.ok){let e=await t.json();c(e)}}catch(e){}},q=async e=>{y(!0),v(""),w("");try{let t=await fetch("/api/questions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(t.ok)w("Question created successfully"),d.oR.success("Question created successfully"),f(!1),await E();else{let e=(await t.json()).error||"Failed to create question";v(e),d.oR.error(e)}}catch(e){v("Error creating question"),d.oR.error("Error creating question")}finally{y(!1)}},k=async e=>{if(b){y(!0),v(""),w("");try{let t=await fetch("/api/questions/".concat(b.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(t.ok)w("Question updated successfully"),d.oR.success("Question updated successfully"),p(null),await E();else{let e=(await t.json()).error||"Failed to update question";v(e),d.oR.error(e)}}catch(e){v("Error updating question"),d.oR.error("Error updating question")}finally{y(!1)}}},A=async e=>{if(confirm("Are you sure you want to delete this question?"))try{let t=await fetch("/api/questions/".concat(e),{method:"DELETE"});if(t.ok)w("Question deleted successfully"),d.oR.success("Question deleted successfully"),await E();else{let e=(await t.json()).error||"Failed to delete question";v(e),d.oR.error(e)}}catch(e){v("Error deleting question"),d.oR.error("Error deleting question")}};(0,r.useEffect)(()=>{var t;let s=async()=>{x(!0),await Promise.all([E(),S()]),x(!1)};(null==e||null==(t=e.user)?void 0:t.departmentId)&&s()},[e]);let R=t.filter(e=>"ALL"===C||e.term===C);return m?(0,l.jsx)(i.A,{allowedRoles:["HOD"],children:(0,l.jsx)(n.A,{title:"Question Management",children:(0,l.jsx)("div",{className:"flex items-center justify-center min-h-64",children:(0,l.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})})}):(0,l.jsx)(i.A,{allowedRoles:["HOD"],children:(0,l.jsx)(n.A,{title:"Question Management",children:(0,l.jsxs)("div",{className:"space-y-6",children:[u&&(0,l.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("h3",{className:"text-sm font-medium text-blue-800",children:["Current Active Term: ",u.activeTerm]}),(0,l.jsx)("p",{className:"text-sm text-blue-700 mt-1",children:"You can only create questions for the active term"})]}),(0,l.jsxs)("span",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat("START"===u.activeTerm?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"),children:[u.activeTerm," Term"]})]})}),(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsx)("div",{className:"flex space-x-4",children:(0,l.jsxs)("select",{value:C,onChange:e=>T(e.target.value),className:"rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",children:[(0,l.jsx)("option",{value:"ALL",children:"All Terms"}),(0,l.jsx)("option",{value:"START",children:"Start of Year"}),(0,l.jsx)("option",{value:"END",children:"End of Year"})]})}),(0,l.jsx)("button",{onClick:()=>f(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors",children:"Create New Question"})]}),(h||b)&&(0,l.jsx)(o,{onSubmit:b?k:q,onCancel:()=>{f(!1),p(null)},initialData:b||void 0,activeTerm:(null==u?void 0:u.activeTerm)||"START",loading:g}),(0,l.jsx)("div",{className:"bg-white shadow rounded-lg",children:(0,l.jsxs)("div",{className:"px-4 py-5 sm:p-6",children:[(0,l.jsxs)("h3",{className:"text-lg leading-6 font-medium text-gray-900 mb-4",children:["Questions (",R.length,")"]}),R.length>0?(0,l.jsx)("div",{className:"space-y-4",children:R.map((e,t)=>(0,l.jsx)("div",{className:"border border-gray-200 rounded-lg p-4",children:(0,l.jsxs)("div",{className:"flex justify-between items-start",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,l.jsxs)("span",{className:"text-sm font-medium text-gray-500",children:["#",e.order||t+1]}),(0,l.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat("START"===e.term?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"),children:e.term}),(0,l.jsx)("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 rounded-full text-xs font-medium",children:(e=>{switch(e){case"TEXT":return"Single Line Text";case"TEXTAREA":return"Multi Line Text";case"MCQ":return"Multiple Choice (Single)";case"CHECKBOX":return"Multiple Choice (Multiple)";default:return e}})(e.type)})]}),(0,l.jsx)("p",{className:"text-gray-900 mb-2",children:e.question}),e.options.length>0&&(0,l.jsxs)("div",{className:"ml-4",children:[(0,l.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Options:"}),(0,l.jsx)("ul",{className:"list-disc list-inside text-sm text-gray-600 space-y-1",children:e.options.map((e,t)=>(0,l.jsx)("li",{children:e},t))})]})]}),(0,l.jsxs)("div",{className:"flex space-x-2 ml-4",children:[(0,l.jsx)("button",{onClick:()=>p(e),className:"text-blue-600 hover:text-blue-500 text-sm font-medium",children:"Edit"}),(0,l.jsx)("button",{onClick:()=>A(e.id),className:"text-red-600 hover:text-red-500 text-sm font-medium",children:"Delete"})]})]})},e.id))}):(0,l.jsxs)("div",{className:"text-center py-8",children:[(0,l.jsx)("div",{className:"text-gray-400 text-4xl mb-4",children:"❓"}),(0,l.jsx)("p",{className:"text-gray-500 mb-2",children:"ALL"===C?"No questions found":"No questions found for ".concat(C," term")}),(0,l.jsx)("p",{className:"text-sm text-gray-400",children:"Create your first question to get started"})]})]})})]})})})}},74340:(e,t,s)=>{Promise.resolve().then(s.bind(s,63879))}},e=>{e.O(0,[6169,2108,699,6671,8892,8441,5964,7358],()=>e(e.s=74340)),_N_E=e.O()}]);